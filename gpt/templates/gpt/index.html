{% load static %} 
<!DOCTYPE html>

<html>

<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ChatDDx - Physician Differential Diagnosis Tool</title>
    <link rel="stylesheet" href="{% static 'gpt/styles.css' %}">
    <link rel="stylesheet" href="{% static 'gpt/loading-spinner.css' %}">
    <style>
          
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
        }

        .toolbar {
            background-color: #ff6e4e;
            color: white;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
        }

        textarea,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #4c95af;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: -6px;
        }

        button:hover {
            background-color: #45a049;
        }
        
        .info-container {
            position: relative;
            bottom: 10px;
        }

        .info-icon__icon {
            font-size: 20px;
            cursor: pointer;
        }

        .info-icon__popup {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            max-width: 500px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1;
        }

        .info-icon__popup table {
            width: 100%;
        }

        .info-icon__popup th,
        .info-icon__popup td {
            padding: 5px;
            text-align: left;
        }

        #chat-log {
            flex: 1;
            width: 100%;
            height: 250px;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 6px 0;
            overflow-y: auto;
            resize: none;
        }

        #copy-button {
            align-self: flex-end;
            margin-top: 6px;
        }

        #loading-spinner {
            display: none;
        }

        h2 {
            margin-top: -45px;
            text-align: center;
        }

    </style>
</head>

<body>
    <div class="toolbar">
        <h1>ChatDDx - Differentialdiagnostiskt beslutsstöd för läkare</h1>
    </div>
    <form id="user-form">
        <div class="container">
            <label for="patientInfo">Skriv patientens symtom, bakgrund och undersökningsfynd :</label>
            <textarea id="user-input" rows="6" placeholder="Ange relevant patientinformation"></textarea>
            <button id="send-button">Generera Differentialdiagnoser</button>
        </div>
        <div class="info-icon">
            <span class="info-icon__icon">ℹ️</span>
            <div class="info-icon__popup">
                <table>
                    <tr>
                        <th>Förslag till inmatning av patientdata</th>
                    </tr>
                    <tr>
                        <td>Exempel 1: Tidigare frisk patient som insjuknat med buksmärta, feber, diarréer och kräkningar efter buffémåltid. Status med nedsatt allmäntillstånd, takykardi, feber och generell buksmärta. CRP 178, leukocytos och blodgas med metabol acidos med hyperkalemi och njursvikt.</td>
                    </tr>
                    <tr>
                        <td>Exempel 2: 67-årig man med tidigare hjärtsvikt, tidigare hjärtinfarkt, hypertoni och diabetes. Inkommer nu med plötslig debut av retrosternal bröstsmärta, andnöd och svettning. Normalt EKG men förhöjt troponin.</td>
                    </tr>
                    <tr>
                        <td>Exempel 3: 21-årig tidigare frisk kvinna inkommer med långsamt insättande lågt sittande buksmärta med illamående och kräkningar. I status AT ua, palpöm i vänster fossa, normalt CRP och urinsticka.</td> 
                    </tr>
                </table>
            </div>
            
            <div id="disclaimer-icon" class="disclaimer-icon">
                <img src="{% static 'gpt/disclaimer1.png' %}" alt="Disclaimer Icon" onclick="showDisclaimer()">
            </div>
            
            <!-- Disclaimer Popup -->
            <div id="disclaimer-popup" class="disclaimer-popup">
                <div class="popup-content">
                    <span class="close" onclick="hideDisclaimer()">&times;</span>
                    <table>
    <tr>
        <table>
            <tr>
                <th>Disclaimer</th>
            </tr>
            <tr>
                <td align="left">Denna applikation använder ChatGPT via API för att generera potentiella differentialdiagnoser baserade på användarens angivna information.</td>
            </tr>
            <tr>
                <td align="left">Det är av yttersta vikt att förstå att informationen som tillhandahålls av denna applikation inte ersätter professionell medicinsk rådgivning, diagnos eller behandling.</td>
            </tr>
            <tr>
                <td align="left">De genererade differentialdiagnoserna är resultatet av algoritmer, inklusive maskininlärning, och bör ses som förslag för vidare utforskning snarare än definitiva slutsatser.</td>
            </tr>
            <tr>
                <td align="left">Användare uppmanas starkt att rådfråga kvalificerad vårdpersonal för korrekt diagnos och personlig medicinsk rådgivning.</td>
            </tr>
            <tr>
                <td align="left">Utvecklarna och leverantörerna av denna applikation, inklusive ChatGPT, tar inget ansvar för noggrannheten, fullständigheten eller tillförlitligheten hos informationen som genereras av denna applikation.</td>
            </tr>
            <tr>
                <td align="left">Användare bör alltid använda sitt eget omdöme och söka medicinsk hjälp från kvalificerad vårdpersonal när de fattar medicinska diagnostiska beslut.</td>
            </tr>
            <tr>
                <td align="left">Genom att använda denna applikation erkänner användare att applikationen inte är en ersättning för professionell medicinsk kompetens och att utvecklarna och leverantörerna inte är ansvariga för några åtgärder som vidtas baserat på den tillhandahållna informationen.</td> 
            </tr>
            <tr>
                <td align="left">Copyright © 2023 ChatDDX</td>
            </tr>
        </table>
    </div>
    
        </div>
        <div class="container">
            <h2>Differentialdiagnoser:</h2>
            <textarea id="chat-log" rows="10" readonly></textarea>
            <button id="copy-button">Kopiera diagnoser</button>
            <div id="loading-spinner"></div>
        </div>
    </form>

    <script>
    const API_URL = "https://api.openai.com/v1/chat/completions";
    const API_KEY = "{{ api_key.key }}";
    const SYSTEM_PROMPTS = [
            {% for prompt in prompts %}
                { role: "{{ prompt.role }}", message: "{{ prompt.message }}" } {% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

    console.log("sendbutton")
</script>
<script src="{% static 'gpt/main.js' %}"></script>
<script>
    document.getElementById("copy-button").addEventListener("click", function () {
        var chatLog = document.getElementById("chat-log");
        chatLog.select();
        document.execCommand("copy");
        alert("Text kopierad till urklipp!");
    });
</script>
</body>

</html> 

